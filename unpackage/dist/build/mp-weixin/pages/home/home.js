(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/home"],{"3dfd":function(t,e,n){"use strict";var o=n("e773"),s=n.n(o);s.a},"456f":function(t,e,n){"use strict";var o,s=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}))},5626:function(t,e,n){"use strict";(function(t){n("4475");o(n("66fd"));var e=o(n("d5c7"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},cf0a:function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("4795")),s=n("2f62");function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function c(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e,n,o,s,i,a){try{var c=t[i](a),r=c.value}catch(u){return void n(u)}c.done?e(r):Promise.resolve(r).then(o,s)}function p(t){return function(){var e=this,n=arguments;return new Promise((function(o,s){var i=t.apply(e,n);function a(t){u(i,o,s,a,c,"next",t)}function c(t){u(i,o,s,a,c,"throw",t)}a(void 0)}))}}var h=function(){n.e("pages/component/pop").then(function(){return resolve(n("d85b"))}.bind(null,n)).catch(n.oe)},d={components:{pop:h},data:function(){return{page:"shop",showPage:!1,containerHeight:800,tabbar:[{iconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_shop.png",selectedIconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_shop_sel.png",title:"店家",page:"shop"},{iconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_photo.png",selectedIconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_photo.png",title:"",page:""},{iconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_user.png",selectedIconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_user_sel.png",title:"我的",page:"user"}],showLoading:!1,shopInfo:{},shopId:"",topNum:0,pageIndex:1,pageSize:5,total:0,isShowScan:!1,commentList:[],popCont:"您今天对此条留言的点赞次数已达上限",finished:!1}},watch:{commentList:{handler:function(t,e){for(var n=0;n<t.length;n++)e[n]!=t[n]&&(this.commentList=t)},deep:!0}},onLoad:function(e){var n=this;return p(o.default.mark((function s(){var i,a,c;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(console.log("home",e),i="",n.$db.get("shop_id")&&(i=n.$db.get("shop_id")),e.scene&&(a=decodeURIComponent(e.scene),i=a),e.id&&(i=e.id),e.page&&(n.page=e.page),n.shopId=i,n.$db.set("shop_id",i),!i){o.next=18;break}return o.next=11,n.getShopIndex();case 11:if(c=o.sent,1==c.status){o.next=16;break}t.showToast({title:"该店铺存在异常~",duration:2e3,icon:"none",mask:!0,success:function(){n.isShowScan=!0,n.shopId="",n.$db.set("shop_id","")}}),o.next=18;break;case 16:return o.next=18,n.postShopCommentsList();case 18:n.init_page_size();case 19:case"end":return o.stop()}}),s)})))()},methods:c({},(0,s.mapMutations)(["shopConfig"]),{scrolltolower:function(){"shop"==this.page&&this.shopId&&!this.finished&&(this.pageIndex++,this.postShopCommentsList())},_changeLike:function(t){var e=this;if(this.$db.userMobile()){var n=t.item,o=(t.bl,t.index),s=+this.commentList[o].zan,i=this.$db.get("userinfo").user_id;this.$http.postSaveZan({cid:n.id,uid:i},(function(t){if(1==t.code){var n=t.data.code,i=t.data.msg;200==n?(e.$set(e.commentList[o],"myZan",1),e.$set(e.commentList[o],"zan",++s)):100==n?(e.popCont=i,e.$refs.popup.$refs.pop.open()):300==n&&(e.$set(e.commentList[o],"myZan",0),e.$set(e.commentList[o],"zan",--s))}else e.$common.errorToShow(t.msg)}))}},_changeFullText:function(t){var e=t.e,n=e.currentTarget.dataset.index,o=e.currentTarget.dataset.text;this.commentList[n].full_text="全文"==o?"收起全文":"全文"},_switchPostComments:function(){this.$db.userMobile()&&t.navigateTo({url:"/pages/index/postComments"})},getShopIndex:function(){var t=this,e=this;return new Promise((function(n,o){e.$http.getShopIndex({shop_id:e.shopId},(function(o){1==o.code?(e.shopInfo=o.data,e.total=o.data.comments.counts||0,e.shopConfig(o.data),n(o.data)):0==o.code?n({status:0}):t.$common.errorToShow(o.msg)}))}))},postShopCommentsList:function(){var t=this,e=this.shopInfo.comments.counts||0,n=this.$db.get("userinfo").user_id;this.$http.postShopCommentsList({shop_id:this.shopId,user_id:n,page:this.pageIndex,page_size:this.pageSize},(function(n){if(1==n.code){var o=n.data;if(null==o||0==o.length)return void(t.finished=!0);1==t.pageIndex&&(t.commentList=[]),t.commentList=t.commentList.concat(o),t.commentList.length>=e&&(t.finished=!0)}else t.$common.errorToShow(n.msg)}))},_handleClick:function(e){var n=this;return p(o.default.mark((function s(){var i,a;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return i=n,n.topNum=n.topNum+.001,n.shopId=e.shop_id,n.$db.set("shop_id",e.shop_id),n.page="shop",o.next=7,n.getShopIndex();case 7:if(a=o.sent,1==a.status){o.next=13;break}return t.showToast({title:"该店铺存在异常~",icon:"none",mask:!0,success:function(){n.isShowScan=!0,n.shopId="",n.$db.set("shop_id","")}}),o.abrupt("return");case 13:return o.next=15,i.postShopCommentsList();case 15:case"end":return o.stop()}}),s)})))()},changeTab:function(e){var n=this;if(e.page){if("user"==e.page&&!this.$db.userMobile())return;this.page=e.page;var o="";o="shop"!=this.page||this.shopId?e.title:"通江好印象",t.setNavigationBarTitle({title:o}),this.topNum+=1e-4}else{if(!this.$db.userMobile())return;if(!this.shopId)return void t.showToast({title:"请选择一个店家",icon:"none"});t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["camera","album"],success:function(e){t.showLoading({title:"上传中..."});var o=n.$db.get("userinfo");t.uploadFile({url:"https://wxhyx.aisspc.cn/addons/qiniu/index/upload",filePath:e.tempFilePaths[0],fileType:"image",name:"file",headers:{Accept:"application/json","Content-Type":"multipart/form-data"},formData:{method:"images.upload",upfile:e.tempFilePaths[0],token:o.token},success:function(n){var o=JSON.parse(n.data);t.navigateTo({url:"/pages/index/postComments?src=".concat(e.tempFilePaths[0],"&tem=").concat(o.data.url)}),t.hideLoading()},complete:function(){},fail:function(t){console.log("this is errormes "+t.message)}})}})}},init_page_size:function(){var e=this;return p(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.$nextTick(p(o.default.mark((function n(){var s,i,a,c,r;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=t.getSystemInfoSync(),i=t.createSelectorQuery().in(e),a=i.select("#tabbar"),n.next=5,e.syncBoundingClientRect(a);case 5:c=n.sent,r=s.windowHeight-c.height,e.containerHeight=r,e.showPage=!0;case 9:case"end":return n.stop()}}),n)}))));case 1:case"end":return n.stop()}}),n)})))()},syncBoundingClientRect:function(t){return new Promise((function(e,n){t.boundingClientRect((function(t){e(t)})).exec()}))}})};e.default=d}).call(this,n("543d")["default"])},d5c7:function(t,e,n){"use strict";n.r(e);var o=n("456f"),s=n("eb3c");for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);n("3dfd");var a,c=n("f0c5"),r=Object(c["a"])(s["default"],o["b"],o["c"],!1,null,"5f9f8d83",null,!1,o["a"],a);e["default"]=r.exports},e773:function(t,e,n){},eb3c:function(t,e,n){"use strict";n.r(e);var o=n("cf0a"),s=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=s.a}},[["5626","common/runtime","common/vendor"]]]);