(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/home/home"],{1953:function(t,e,n){},3428:function(t,e,n){"use strict";var o=n("1953"),s=n.n(o);s.a},"4eea":function(t,e,n){"use strict";n.r(e);var o=n("769c"),s=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=s.a},"591e":function(t,e,n){"use strict";(function(t){n("7c16");o(n("66fd"));var e=o(n("c294"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"769c":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("4795")),s=n("2f62");function i(t){return t&&t.__esModule?t:{default:t}}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(Object(n),!0).forEach((function(e){a(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function u(t,e,n,o,s,i,c){try{var r=t[i](c),a=r.value}catch(u){return void n(u)}r.done?e(a):Promise.resolve(a).then(o,s)}function p(t){return function(){var e=this,n=arguments;return new Promise((function(o,s){var i=t.apply(e,n);function c(t){u(i,o,s,c,r,"next",t)}function r(t){u(i,o,s,c,r,"throw",t)}c(void 0)}))}}var h=function(){n.e("pages/component/pop").then(function(){return resolve(n("faa7"))}.bind(null,n)).catch(n.oe)},d={components:{pop:h},data:function(){return{page:"shop",showPage:!1,containerHeight:800,tabbar:[{iconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_shop.png",selectedIconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_shop_sel.png",title:"店家",page:"shop"},{iconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_photo.png",selectedIconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_photo.png",title:"",page:""},{iconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_user.png",selectedIconPath:"https://wxhyx-cdn.aisspc.cn/static/tabIcon_user_sel.png",title:"我的",page:"user"}],showLoading:!1,shopInfo:{},shopId:"",topNum:0,pageIndex:1,pageSize:5,total:0,msgNum:0,isShowScan:!1,commentList:[],popCont:"您今天对此条留言的点赞次数已达上限",finished:!1}},watch:{commentList:{handler:function(t,e){for(var n=0;n<t.length;n++)e[n]!=t[n]&&(this.commentList=t)},deep:!0}},onLoad:function(e){var n=this;return p(o.default.mark((function s(){var i,c,r;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(console.log("home",e),i="",n.$db.get("shop_id")&&(i=n.$db.get("shop_id")),e.scene&&(c=decodeURIComponent(e.scene),i=c),e.id&&(i=e.id),e.page&&(n.page=e.page),n.shopId=i,n.$db.set("shop_id",i),!i){o.next=19;break}return o.next=12,n.getShopIndex();case 12:if(r=o.sent,1==r.status){o.next=17;break}t.showToast({title:"该店铺存在异常~",duration:2e3,icon:"none",mask:!0,success:function(){n.isShowScan=!0,n.shopId="",n.$db.set("shop_id","")}}),o.next=19;break;case 17:return o.next=19,n.postShopCommentsList();case 19:n.init_page_size();case 21:case"end":return o.stop()}}),s)})))()},onShow:function(){this.getUserInfo()},methods:r({},(0,s.mapMutations)(["shopConfig"]),{getUserInfo:function(){var t=this;this.$http.getUserInfo({},(function(e){1==e.code?t.msgNum=e.data.userinfo.replyCount:t.$common.errorToShow(e.msg)}))},scrolltolower:function(){"shop"==this.page&&this.shopId&&!this.finished&&(this.pageIndex++,this.postShopCommentsList())},_changeLike:function(t){var e=this;if(this.$db.userMobile()){var n=t.item,o=(t.bl,t.index),s=+this.commentList[o].zan,i=this.$db.get("userinfo").user_id;this.$http.postSaveZan({cid:n.id,uid:i},(function(t){if(1==t.code){var n=t.data.code,i=t.data.msg;200==n?(e.$set(e.commentList[o],"myZan",1),e.$set(e.commentList[o],"zan",++s)):100==n?(e.popCont=i,e.$refs.popup.$refs.pop.open()):300==n&&(e.$set(e.commentList[o],"myZan",0),e.$set(e.commentList[o],"zan",--s))}else e.$common.errorToShow(t.msg)}))}},_changeFullText:function(t){var e=t.e,n=e.currentTarget.dataset.index,o=e.currentTarget.dataset.text;this.commentList[n].full_text="全文"==o?"收起全文":"全文"},_switchPostComments:function(){this.$db.userMobile()&&t.navigateTo({url:"/pages/index/postComments"})},getShopIndex:function(){var t=this,e=this;return new Promise((function(n,o){e.$http.getShopIndex({shop_id:e.shopId},(function(o){1==o.code?(e.shopInfo=o.data,e.total=o.data.comments.counts||0,e.shopConfig(o.data),n(o.data)):0==o.code?n({status:0}):t.$common.errorToShow(o.msg)}))}))},postShopCommentsList:function(){var t=this,e=this.shopInfo.comments.counts||0,n=this.$db.get("userinfo").user_id;this.$http.postShopCommentsList({shop_id:this.shopId,user_id:n,page:this.pageIndex,page_size:this.pageSize},(function(n){if(1==n.code){var o=n.data;if(null==o||0==o.length)return void(t.finished=!0);1==t.pageIndex&&(t.commentList=[]),t.commentList=t.commentList.concat(o),t.commentList.length>=e&&(t.finished=!0)}else t.$common.errorToShow(n.msg)}))},_handleClick:function(e){var n=this;return p(o.default.mark((function s(){var i,c;return o.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return i=n,n.topNum=n.topNum+.001,n.shopId=e.shop_id,n.$db.set("shop_id",e.shop_id),n.page="shop",o.next=7,n.getShopIndex();case 7:if(c=o.sent,1==c.status){o.next=13;break}return t.showToast({title:"该店铺存在异常~",icon:"none",mask:!0,success:function(){n.isShowScan=!0,n.shopId="",n.$db.set("shop_id","")}}),o.abrupt("return");case 13:return o.next=15,i.postShopCommentsList();case 15:case"end":return o.stop()}}),s)})))()},changeTab:function(e){var n=this;if(e.page){if("user"==e.page&&!this.$db.userMobile())return;this.page=e.page;var o="";o="shop"!=this.page||this.shopId?e.title:"通江好印象",t.setNavigationBarTitle({title:o}),this.topNum+=1e-4}else{if(!this.$db.userMobile())return;if(!this.shopId)return void t.showToast({title:"请选择一个店家",icon:"none"});this.$http.uploadImage(1,(function(e,o){1==e.code?t.navigateTo({url:"/pages/index/postComments?src=".concat(o,"&tem=").concat(e.data.url)}):n.$common.errorToShow(e.msg)}))}},init_page_size:function(){var e=this;return p(o.default.mark((function n(){return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:e.$nextTick(p(o.default.mark((function n(){var s,i,c,r,a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return s=t.getSystemInfoSync(),i=t.createSelectorQuery().in(e),c=i.select("#tabbar"),n.next=5,e.syncBoundingClientRect(c);case 5:r=n.sent,a=s.windowHeight-r.height,e.containerHeight=a,e.showPage=!0;case 9:case"end":return n.stop()}}),n)}))));case 1:case"end":return n.stop()}}),n)})))()},syncBoundingClientRect:function(t){return new Promise((function(e,n){t.boundingClientRect((function(t){e(t)})).exec()}))}})};e.default=d}).call(this,n("543d")["default"])},"84fe":function(t,e,n){"use strict";var o,s=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"b",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}))},c294:function(t,e,n){"use strict";n.r(e);var o=n("84fe"),s=n("4eea");for(var i in s)"default"!==i&&function(t){n.d(e,t,(function(){return s[t]}))}(i);n("3428");var c,r=n("f0c5"),a=Object(r["a"])(s["default"],o["b"],o["c"],!1,null,"e85eb64c",null,!1,o["a"],c);e["default"]=a.exports}},[["591e","common/runtime","common/vendor"]]]);